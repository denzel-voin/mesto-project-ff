(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2",headers:{authorization:"9170d58a-0512-40e6-96dd-ff17859c3ccb","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},r=document.querySelector("#card-template").content,n=function(e){var t=r.querySelector(".card").cloneNode(!0);t.id=e.card.id;var n=t.querySelector(".card__image");if(t.querySelector(".card__like-number").textContent=e.card.likes.length,n.src=e.card.link,n.alt="".concat(e.card.name),t.querySelector(".card__title").textContent=e.card.name,e.card.likes.forEach((function(r){r._id===e.userId&&t.querySelector(".card__like-button").classList.add("card__like-button_is-active")})),e.userId===e.card.ownerId){var o=document.createElement("button");o.classList.add("card__delete-button"),t.appendChild(o),o.addEventListener("click",e.callBackDeleteCard)}return t.querySelector(".card__like-button").addEventListener("click",e.callBackLikeCard),n.addEventListener("click",e.openCard),t},o=function(e){e.classList.add("popup_is-opened"),window.addEventListener("keydown",a),window.addEventListener("click",i)},c=function(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keydown",a),window.removeEventListener("click",i)},a=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&c(t)}},i=function(e){var t=e.target;t.classList.contains("popup_is-opened")&&c(t)},u=function(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)},l=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(r.inactiveButtonClass)):u(t,r)},s=function(e,t){var r=e.querySelectorAll(".".concat(t.errorClass)),n=e.querySelectorAll(t.inputSelector),o=e.querySelectorAll(".".concat(t.inputErrorClass));r&&(n.forEach((function(e){e.value=""})),r.forEach((function(e){e.textContent="",e.classList.remove(t.errorClass)})),o.forEach((function(e){e.classList.remove(t.inputErrorClass)})))};function d(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?n:r}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var n=t.submitter,o=n.textContent;d(!0,n,o,r),e().then((function(){t.target.reset()})).catch((function(e){return console.error("Ошибка: ",e)})).finally((function(){d(!1,n,o)}))}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m=document.querySelector(".places__list"),_=document.querySelector(".popup__input_type_card-name"),v=document.querySelector(".popup__input_type_url"),y=document.querySelector(".popup_type_image"),h=document.querySelector(".profile__edit-button"),S=document.querySelectorAll(".popup__close"),b=document.querySelector(".profile__add-button"),E=document.querySelectorAll(".popup"),C=document.forms["edit-profile"],k=document.forms["edit-avatar"],q=document.forms["new-place"],L=document.querySelector(".popup__input_type_name"),g=document.querySelector(".popup__input_type_description"),w=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),x=document.querySelector(".popup_type_new-card"),I=document.querySelector(".popup_type_edit"),T=y.querySelector(".popup__image"),U=y.querySelector(".popup__caption"),B=document.querySelector(".profile__avatar"),j=document.querySelector(".profile__title"),O=document.querySelector("#input__avatar-link"),P=document.querySelector(".profile__image-edit-button"),D=document.querySelector(".popup_type_edit-avatar"),M=[],N={card:null,callBackDeleteCard:function(r){var n=r.target.closest(".card");(function(r){return fetch("".concat(e.baseUrl,"/cards/").concat(r.id),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))})(n).then(n.remove()).catch((function(e){return console.error("Ошибка: ",e)}))},callBackLikeCard:function(r){var n=r.target.closest(".card__like-button"),o=r.target.closest(".card__like-button_is-active"),c=r.target.closest(".card"),a=c.querySelector(".card__like-number");(function(r,n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n.id),{method:r?"DELETE":"PUT",headers:e.headers}).then((function(e){return t(e)}))})(o,c).then((function(e){a.textContent=e.likes.length,n.classList.toggle("card__like-button_is-active")})).catch((function(e){return console.error("Ошибка: ",e)}))},openCard:function(e){o(y);var t=e.target.closest(".card__image");T.src=t.src,U.textContent=t.alt,T.alt=t.alt}},J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return t(e)})),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return t(e)}))]).then((function(e){var t,r,o=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,a,i=[],u=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=c.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];A.textContent=c.about,j.textContent=c.name,B.src=c.avatar,N.userId=c._id,a.forEach((function(e){M.push({name:e.name,link:e.link,likes:e.likes,owner:e.owner.name,id:e._id,ownerId:e.owner._id})})),M.forEach((function(e){N.card=e,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"append",r=n(N);m[t](r)}(e)}))})).catch((function(e){return console.error("Ошибка: ",e)})),C.addEventListener("submit",(function(r){f((function(){return(r=L.value,n=g.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:"".concat(r),about:"".concat(n)})}).then((function(e){return t(e)}))).then((function(e){w.textContent=e.name,A.textContent=e.about,c(I)}));var r,n}),r)})),q.addEventListener("submit",(function(r){var o=_.value,a=v.value,i=void 0;N.userId=i;var u={name:o,link:a,likes:[],ownerId:i};f((function(){return function(r,n){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:"".concat(r),link:"".concat(n)})}).then((function(e){return t(e)}))}(o,a).then((function(e){u.id=e._id,N.card=u;var t=n(N);m.prepend(t),c(x)}))}),r)})),k.addEventListener("submit",(function(r){f((function(){return(r=O.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then((function(e){return t(e)}))).then((function(e){B.src=e.avatar,O.value="",c(D)}));var r}),r)})),E.forEach((function(e){return e.classList.add("popup_is-animated")})),S.forEach((function(e){e.addEventListener("click",(function(){return E.forEach(c)}))})),h.addEventListener("click",(function(){o(I),s(I,J),L.value=w.textContent,g.value=A.textContent})),b.addEventListener("click",(function(){o(x),s(x,J)})),P.addEventListener("click",(function(){o(D),s(D,J)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);l(r,n,t),e.addEventListener("reset",(function(){u(n,t)})),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,o,t),l(r,n,t)}))}))}(t,e)}))}(J)})();