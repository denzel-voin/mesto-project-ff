(()=>{"use strict";var e=document.querySelector("#card-template").content,t=function(t,o,r,n){var c=e.querySelector(".card").cloneNode(!0);c.id=t.id;var i=c.querySelector(".card__image");e.querySelector(".card__like-number").textContent=t.likes.length,i.src=t.link,i.alt="".concat(t.name),c.querySelector(".card__title").textContent=t.name;var a=document.querySelector(".profile__title");if(t.likes.forEach((function(e){e.name===a.textContent&&c.querySelector(".card__like-button").classList.add("card__like-button_is-active")})),a.textContent===t.owner){var u=document.createElement("button");u.classList.add("card__delete-button"),c.appendChild(u),c.querySelector(".card__delete-button").addEventListener("click",o)}return c.querySelector(".card__like-button").addEventListener("click",r),i.addEventListener("click",n),c},o=function(e){var t=e.target.closest(".card__like-button");t.classList.toggle("card__like-button_is-active");var o=e.target.closest(".card__like-button_is-active"),r=e.target.closest(".card"),n=r.querySelector(".card__like-number");fetch("https://nomoreparties.co/v1/cohort-magistr-2/cards/likes/".concat(r.id),{method:o?"PUT":"DELETE",headers:{authorization:"9170d58a-0512-40e6-96dd-ff17859c3ccb"}}).then((function(e){return e.json()})).then((function(e){n.textContent=e.likes.length})).catch((function(e){t.classList.toggle("card__like-button_is-active"),console.error("Error:",e)}))},r=function(e){var t=e.target.closest(".card");fetch("https://nomoreparties.co/v1/cohort-magistr-2/cards/".concat(t.id),{method:"DELETE",headers:{authorization:"9170d58a-0512-40e6-96dd-ff17859c3ccb"}}),t.remove()},n=function(e){e.classList.add("popup_is-opened"),window.addEventListener("keydown",i),window.addEventListener("click",a)},c=function(e){e.classList.remove("popup_is-opened"),window.removeEventListener("keydown",i),window.removeEventListener("click",a)},i=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&c(t)}},a=function(e){var t=e.target;if(t.closest(".popup")&&!t.closest(".popup__content")){var o=document.querySelector(".popup_is-opened");c(o)}},u=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("form__submit_inactive")):(t.disabled=!0,t.classList.add("form__submit_inactive"))},d=document.querySelector(".places__list"),s=document.querySelector(".popup__input_type_card-name"),l=document.querySelector(".popup__input_type_url"),p=document.querySelector(".popup_type_image"),_=document.querySelector(".profile__edit-button"),m=document.querySelectorAll(".popup__close"),f=document.querySelector(".profile__add-button"),v=document.querySelectorAll(".popup"),y=document.querySelector(".popup__form"),h=document.querySelector(".popup_type_new-card .popup__form"),S=document.querySelector(".popup__input_type_name"),q=document.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),k=document.querySelector(".popup_type_new-card"),g=document.querySelector(".popup_type_edit"),L=p.querySelector(".popup__image"),C=p.querySelector(".popup__caption"),w=[];fetch("https://nomoreparties.co/v1/cohort-magistr-2/cards",{method:"GET",headers:{authorization:"9170d58a-0512-40e6-96dd-ff17859c3ccb"}}).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){w.push({name:e.name,link:e.link,likes:e.likes,owner:e.owner.name,id:e._id})})),w.forEach((function(e){x(t(e,r,o,A))}))})),fetch("https://nomoreparties.co/v1/cohort-magistr-2/users/me",{method:"GET",headers:{authorization:"9170d58a-0512-40e6-96dd-ff17859c3ccb"}}).then((function(e){return e.json()})).then((function(e){var t=document.querySelector(".profile__image"),o=document.querySelector(".profile__title");document.querySelector(".profile__description").textContent=e.about,o.textContent=e.name,t.src=e.avatar}));var x=function(e){d.append(e)},A=function(e){n(p),L.src=e.target.closest(".card__image").src,C.textContent=e.target.closest(".card__image").alt,L.alt=e.target.closest(".card__image").alt};v.forEach((function(e){return e.classList.add("popup_is-animated")})),m.forEach((function(e){e.addEventListener("click",(function(){return v.forEach((function(e){return c(e)}))}))})),_.addEventListener("click",(function(){n(g),S.value=b.textContent,q.value=E.textContent;var e=g.querySelectorAll(".form__input-error_active");if(e){e.forEach((function(e){e.textContent="",e.classList.remove("form__input-error_active")}));var t=g.querySelectorAll(".form__input_type_error");t&&t.forEach((function(e){e.classList.remove("form__input_type_error")}))}})),f.addEventListener("click",(function(){return n(k)})),y.addEventListener("submit",(function(e){e.preventDefault();var t=S.value,o=q.value;b.textContent=t,E.textContent=o,c(g),fetch("https://nomoreparties.co/v1/cohort-magistr-2/users/me",{method:"PATCH",headers:{authorization:"9170d58a-0512-40e6-96dd-ff17859c3ccb","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),about:"".concat(o)})})})),h.addEventListener("submit",(function(e){e.preventDefault();var n=s.value,i=l.value,a={name:n,link:i,likes:[],owner:document.querySelector(".profile__title").textContent};h.reset();var u=h.querySelector(".popup__button");u.disabled=!0,u.classList.add("form__submit_inactive"),fetch("https://nomoreparties.co/v1/cohort-magistr-2/cards",{method:"POST",headers:{authorization:"9170d58a-0512-40e6-96dd-ff17859c3ccb","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n),link:"".concat(i),likes:[]})}),d.prepend(t(a,r,o,A)),c(k)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");u(t,o),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("form__input_type_error"),o.classList.remove("form__input-error_active"),o.textContent=""}(e,t):function(e,t,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("form__input_type_error"),r.textContent=o,r.classList.add("form__input-error_active")}(e,t,t.validationMessage)}(e,r),u(t,o)}))}))}(e)}))})();